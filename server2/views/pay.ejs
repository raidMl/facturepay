<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسديد الفواتير</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="css/pub.css"></head>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: right;
        background-color: #f5f5f5;
        margin: 0;
        padding: 0;
        overflow: hidden;
        overflow-y:auto;
    }
    
    header {
       /* background-color: #333;*/
        background: linear-gradient(to right, #2d48dfee, #350d91f5);

        color: #fff;
        padding: 20px;
        text-align: center;
    }
    header h1 {
color: #fff;    }
    main {
        padding: 20px;
    }
    
    .invoice-payment {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
    }
    
    h1, h2 {
        color: #333;
    }
    
    form {
        display: flex;
        flex-direction: column;
    }
    
    label {
        margin-bottom: 10px;
    }
    
    input[type="text"],
    input[type="number"],
    input[type="date"],
    select {
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 16px;
    }
    
    button {
        padding: 12px 20px;
        font-size: 16px;
        background: linear-gradient(to right, #2d48dfee, #350d91f5);
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    button:hover {
        background-color: #555;
    }
    
</style>
<body>
    <header  style="position:sticky;top:0;width:100%">
        <h1>تسديد الفواتير</h1>
    </header>

    <main>
        <section class="invoice-payment" >
            <!-- <h2>سداد الفاتورة</h2> -->
            <form id="paymentForm" dir="rtl" onsubmit="handleSubmit()" >
                <label for="factureType">نوع الفاتورة:</label>
                <select id="factureType" name="factureType">
                    <option value="فاتورة الكهرباء ">فاتورة الكهرباء </option>
                    <option value="فاتورة الغاز">فاتورة الغاز</option>
                    <option value="فاتورة الهاتف">فاتورة الهاتف</option>
                    <option value="فاتورة الانترنت">فاتورة الانترنت</option>
                </select>
                
                <label for="invoiceNumber">رقم الفاتورة:</label>
                <select name="factureNumber" id="factureNumber" onchange="updateMontant()">
                    <% if (invoices && invoices.length > 0) { %>
                        <% invoices.forEach((invoice) => { %>
                            <option value="<%= invoice.id %>"> <%= invoice.id %> </option>
                        <% }); %>
                    <% } else { %>
                        <option value="0">لا توجد فواتير غير مدفوعة.</option>
                    <% } %>
                </select>
                    
               
                          

                <label for="amount">المبلغ:</label>
                <select name="amount" id="amount" onchange="updateMontant()">
                    <% if (invoices && invoices.length > 0) { %>
                        <% invoices.forEach((invoice) => { %>
                            <option value="<%= invoice.montant %>"> <%= invoice.montant %> </option>
                        <% }); %>
                    <% }   %>
                        
                </select>                <label for="cardNumber">رقم البطاقة:</label>
                <input type="number" id="cardNumber" name="cardNumber" required>
                <label for="expiryDate">تاريخ الانتهاء:</label>
                <input type="date" id="expiryDate" name="expiryDate" required>
                <label for="cvv">الرقم السري:</label>
                <input type="number" id="cvv" name="cvv" required>
                <label for="name">الاسم على البطاقة:</label>
                <input type="text" id="name" name="name" required>
                
                
                
                
                <button type="submit" >تسديد الفاتورة</button>
            </form>
        </section>
    </main>

    <footer>
        <p>© 2024 تسديد الفواتير</p>
    </footer>

    <script>
        const mydata=[]
        fetch('/api/facture/pending')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            //const options = document.getElementById('factureNumber');
            data.forEach(item => {
              mydata.append( {"id":item.id,"montant":item.montant,"name":item.name})
                })})

                console.log(mydata);
        function updateMontant() {
            var invoiceNumber = document.getElementById('factureNumber').value;
            invoiceNumber = Number(invoiceNumber);
            console.log(invoiceNumber);
          }

         async function handleSubmit() {
            event.preventDefault();
            var factureType = document.getElementById('factureType').value;
            var factureNumber = document.getElementById('factureNumber').value;
            var amount = document.getElementById('amount').value;
            var cardNumber = document.getElementById('cardNumber').value;
            var expiryDate = document.getElementById('expiryDate').value;
            var cvv = document.getElementById('cvv').value;
            var name = document.getElementById('name').value;
            var data = {
                factureType: factureType,
                factureNumber: factureNumber,
                montant: Number(amount),
                numero: cardNumber,
                date_expiration: expiryDate,
                cvv: cvv,
                fname: name
            };
            fetch('/api/pay/payment', {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                alert('تم تسديد الفاتورة بنجاح.');
                window.location.href = '/history';
            })
            .catch(error => {
                alert('حدث خطأ أثناء تسديد الفاتورة.');
            });



        }
        

     
        
    </script>

    <div style="position:fixed;bottom:0;margin :0;width:100%">
        <div class="footer">
          <a href="./main" class="profile">
              <i class="fas fa-home"></i>
              <p>الصفحة الرئيسية</p>
          </a>
      
          <a href="./history" class="profile">
              <i class="fa fa-history" aria-hidden="true"></i>
              <p>السجلات</p>
          </a>
      
          <a href="./userProfile" class="profile">
              <i class="fas fa-user"></i>
              <p>ملفي الشخصي</p>
          </a>
      </div>
      </div>
</body>
</html>
